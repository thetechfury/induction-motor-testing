{% extends 'base.html' %}
{% load static %}
{% block content %}

    <div class="d-flex justify-content-between">
        <div class="datatable-search datatable-top">
            <a href="{% url 'home' %}" type="button" class="btn btn-primary">
                <i class="bi bi-arrow-left-circle-fill"></i> Back to Home</a>
        </div>
        <div class="mb-3 clearfix">
            <a href="{% url 'pdf' inductionMotorReport.id %}" class="text-white btn btn-success"
               target="_blank" type="button"><i class="bi bi-file-earmark-pdf-fill"></i> Generate Report</a>
        </div>
    </div>

    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <h5 class="card-title">Please fill and save the forms below.</h5>
                            <div class="text-center datatable-top mt-2">
                                <button type="button" class="btn btn-warning" data-bs-toggle="modal"
                                        data-bs-target="#edit-modal" id="update-modal">Update This Record
                                </button>
                            </div>
                        </div>

                        <!-- Default Tabs -->
                        <ul class="nav nav-pills justify-content-center" id="testFormTabs" role="tablist">
                            {% if electric_resistance_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="electric-tab" data-bs-toggle="tab"
                                            data-bs-target="#electric" type="button" role="tab" aria-controls="electric"
                                            aria-selected="true">Electric Resistance Test
                                    </button>
                                </li>
                            {% endif %}
                            {% if temperature_rise_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="temperature-tab" data-bs-toggle="tab"
                                            data-bs-target="#temperature" type="button" role="tab"
                                            aria-controls="temperature" aria-selected="false" tabindex="-1">Temperature
                                        Rise
                                        Test
                                    </button>
                                </li>
                            {% endif %}
                            {% if performance_determination_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="performance-tab" data-bs-toggle="tab"
                                            data-bs-target="#performance" type="button" role="tab"
                                            aria-controls="performance" aria-selected="false" tabindex="-1">Performance
                                        Determination Test
                                    </button>
                                </li>
                            {% endif %}
                            {% if no_load_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="noload-tab" data-bs-toggle="tab"
                                            data-bs-target="#noload"
                                            type="button" role="tab" aria-controls="noload" aria-selected="false"
                                            tabindex="-1">No Load Test
                                    </button>
                                </li>
                            {% endif %}
                            {% if withstand_voltage_ac_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="withstand-tab" data-bs-toggle="tab"
                                            data-bs-target="#withstand" type="button" role="tab"
                                            aria-controls="withstand"
                                            aria-selected="false" tabindex="-1">Withstand Voltage AC Test
                                    </button>
                                </li>
                            {% endif %}
                            {% if insulation_resistance_test %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="insulation-tab" data-bs-toggle="tab"
                                            data-bs-target="#insulation" type="button" role="tab"
                                            aria-controls="insulation"
                                            aria-selected="false" tabindex="-1">Insulation Resistance Test
                                    </button>
                                </li>
                            {% endif %}
                        </ul>
                        <div class="tab-content pt-2" id="myTabContent">
                            {% if electric_resistance_test %}
                                <div class="tab-pane fade" id="electric" role="tabpanel" aria-labelledby="electric-tab">
                                    <form id="electric-form" class="row g-3"
                                          action="{% url 'electric-form' inductionMotorReport.id %}" method="post">
                                        {% csrf_token %}
                                        {% for field in electric_resistance_test %}
                                            <div class="col-md-12">
                                                <div class="form-floating">
                                                    {{ field }}
                                                    {{ field.label_tag }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}

                            {% if temperature_rise_test %}
                                <div class="tab-pane fade" id="temperature" role="tabpanel"
                                     aria-labelledby="temperature-tab">
                                    <form id="temperature-form" class="row g-3"
                                          action="{% url 'temperature-form' inductionMotorReport.id %}" method="post">
                                        {% csrf_token %}
                                        {% for field in temperature_rise_test %}
                                            <div class="col-md-12">
                                                <div class="form-floating">
                                                    {{ field }}
                                                    {{ field.label_tag }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}

                            {% if performance_determination_test %}
                                <div class="tab-pane fade" id="performance" role="tabpanel"
                                     aria-labelledby="performance-tab">
                                    <form id="performance-form" class="row g-3"
                                          action="{% url 'performance-form' inductionMotorReport.id %}" method="post"
                                          enctype="multipart/form-data">
                                        {% csrf_token %}
                                        {% for field in performance_determination_test %}
                                            <div class="col-md-2">
                                                {{ field.label_tag }}
                                            </div>
                                            <div class="col-md-10">
                                                {{ field }}
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}

                            {% if no_load_test %}
                                <div class="tab-pane fade" id="noload" role="tabpanel" aria-labelledby="noload-tab">
                                    <form id="noload-form" class="row g-3"
                                          action="{% url 'noload-form' inductionMotorReport.id %}" method="post">
                                        {% csrf_token %}
                                        {% for field in no_load_test %}
                                            <div class="col-md-12">
                                                <div class="form-floating">
                                                    {{ field }}
                                                    {{ field.label_tag }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}

                            {% if withstand_voltage_ac_test %}
                                <div class="tab-pane fade" id="withstand" role="tabpanel"
                                     aria-labelledby="withstand-tab">
                                    <form id="withstand-form" class="row g-3"
                                          action="{% url 'withstand-form' inductionMotorReport.id %}" method="post">
                                        {% csrf_token %}
                                        {% for field in withstand_voltage_ac_test %}
                                            <div class="col-md-12">
                                                <div class="form-floating">
                                                    {{ field }}
                                                    {{ field.label_tag }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}

                            {% if insulation_resistance_test %}
                                <div class="tab-pane fade" id="insulation" role="tabpanel"
                                     aria-labelledby="insulation-tab">
                                    <form id="insulation-form" class="row g-3"
                                          action="{% url 'insulation-form' inductionMotorReport.id %}" method="post">
                                        {% csrf_token %}
                                        {% for field in insulation_resistance_test %}
                                            <div class="col-md-12">
                                                <div class="form-floating">
                                                    {{ field }}
                                                    {{ field.label_tag }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}
                        </div><!-- End Default Tabs -->
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block scripts %}


    <script>
        $(document).ready(function () {
            $('#electric-form').submit(function (e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_electric_resistance_test-resistance_ohm_1').val(data.resistance_ohm_1);
                        $('#id_electric_resistance_test-resistance_ohm_2').val(data.resistance_ohm_2);
                        $('#id_electric_resistance_test-resistance_ohm_3').val(data.resistance_ohm_3);
                        $('#id_electric_resistance_test-ambient_temperature_C').val(data.ambient_temperature_C);
                        $('#id_electric_resistance_test-unbalance_percentage').val(data.unbalance_percentage);

                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#temperature-form').submit(function (e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_temperature_rise_test-voltage').val(data.voltage);
                        $('#id_temperature_rise_test-winding').val(data.winding);
                        $('#id_temperature_rise_test-frequency').val(data.frequency);
                        $('#id_temperature_rise_test-de_bearing').val(data.de_bearing);
                        $('#id_temperature_rise_test-nde_bearing').val(data.nde_bearing);

                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#noload-form').submit(function (e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_no_load_test-voltage').val(data.voltage);
                        $('#id_no_load_test-current').val(data.current);
                        $('#id_no_load_test-power').val(data.power);
                        $('#id_no_load_test-frequency').val(data.frequency);
                        $('#id_no_load_test-speed').val(data.speed);
                        $('#id_no_load_test-direction_of_rotation').val(data.direction_of_rotation);
                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#withstand-form').submit(function (e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_withstand_voltage_ac_test-description').val(data.description);
                        $('#id_withstand_voltage_ac_test-voltage_kv').val(data.voltage_kv);
                        $('#id_withstand_voltage_ac_test-time_in_seconds').val(data.time_in_seconds);
                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#insulation-form').submit(function (e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_insulation_resistance_test-description').val(data.description);
                        $('#id_insulation_resistance_test-voltage').val(data.voltage);
                        $('#id_insulation_resistance_test-insulation_resistance').val(data.insulation_resistance);
                        $('#id_insulation_resistance_test-time_in_seconds').val(data.time_in_seconds);
                        $('#id_insulation_resistance_test-ambient_temperature_C').val(data.ambient_temperature_C);
                        $('#id_insulation_resistance_test-humidity_percentage').val(data.humidity_percentage);
                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#performance-form').submit(function (e) {
                e.preventDefault();
                var formData = new FormData(this);
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        console.log(data);
                        // Update form fields with saved data
                        $('#id_performance_determination_test-voltage').val(data.voltage);
                        $('#id_performance_determination_test-frequency').val(data.frequency);
                        $('#id_performance_determination_test-nominal_t').val(data.nominal_t);
                        $('#id_performance_determination_test-file_1').val(data.file_1);
                        $('#id_performance_determination_test-file_2').val(data.file_2);
                        $('#id_performance_determination_test-file_3').val(data.file_3);
                        $('#id_performance_determination_test-file_4').val(data.file_4);
                        // Optionally, display a success message or perform other actions
                        alert('Form data saved successfully!');
                    },
                });
            });
        });
    </script>
{% endblock %}
