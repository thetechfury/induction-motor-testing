{% load static %}

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}MOTOR REPORTING SOFTWARE{% endblock %}</title>
    <link
      rel="stylesheet"
      href="{% static 'assets/vendor/jquery-ui/css/jquery-ui.min.css' %}"
    />
    <link
      rel="stylesheet"
      href="{% static 'assets/vendor/jquery-ui/css/jquery-ui-theme.css' %}"
    />
    
    <!-- Favicons -->
    <link href="{% static 'assets/img/favicon.png' %}" rel="icon" />
    <link
      href="{% static 'assets/img/apple-touch-icon.png' %}"
      rel="apple-touch-icon"
    />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <link href="{% static 'assets/css/bootstrap.min.css' %}" rel="stylesheet" />
    <link
      href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"
    />
    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet" />

    {% block css_files %}{% endblock css_files %}
   
  </head>

  <body>
    <header id="header" class="header fixed-top d-flex align-items-center">
      <div
        class="d-flex align-items-center justify-content-between"
        style="width: 80%"
      >
        <div class="logo d-flex align-items-center">
          <img src="{% static 'assets/img/logo.png' %}" alt="" />
          <span class="d-none d-lg-block">MOTOR REPORTING SOFTWARE</span>
        </div>
      </div>
      <!-- End Logo -->

      <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
          <li class="nav-item dropdown pe-3">
            <a
              class="nav-link nav-profile d-flex align-items-center pe-0"
              href="#"
              data-bs-toggle="dropdown"
            >
              <span class="d-none d-md-block dropdown-toggle ps-2"
                >{{ user.username }}</span
              > </a
            ><!-- End Profile Iamge Icon -->

            <ul
              class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile"
            >
              <li class="dropdown-header">
                <h6>
                  {% if user.first_name %} {{ user.first_name }} {{user.last_name }} {% else %} {{ user.username }} {% endif %}
                </h6>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>
              <li>
                <form action="{% url 'logout' %}" method="post">
                  {% csrf_token %}
                  <button
                    class="dropdown-item d-flex align-items-center"
                    type="submit"
                  >
                    <i class="bi bi-box-arrow-right"></i><span>Sign Out</span>
                  </button>
                </form>
              </li>
            </ul>
            <!-- End Profile Dropdown Items -->
          </li>
          <!-- End Profile Nav -->
        </ul>
      </nav>
      <!-- End Icons Navigation -->
    </header>
    <!-- End Header -->

    <main id="main" class="main">
      <div class="container-fluid">{% block content %} {% endblock %}</div>
      {% include 'report_modal.html' %} {% include 'edit_modal.html' %}
    </main>

    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>TheTechFury</span></strong
        >. All Rights Reserved
      </div>
    </footer>

    <script src="{% static 'assets/js/jQuery-3.7.js' %}"></script>
    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/jquery-ui/js/jquery-ui.min.js' %}"></script>
    <script src="{% static 'assets/js/index.js' %}"></script>

    <script src="{% static 'assets/js/html_to_image.js' %}"></script>
    <script>

      $(document).ready(function () {
    var datepickers = document.getElementsByClassName('datepicker');
    var today = new Date();
    var year = today.getFullYear();
    var month = (today.getMonth() + 1).toString().padStart(2, '0');
    var day = today.getDate().toString().padStart(2, '0');
    var formattedDate = year + '-' + month + '-' + day;

       for (var i = 0; i < datepickers.length; i++) {
        if (!datepickers[i].value) {
            datepickers[i].value = formattedDate;
        }
    }

    $('.datepicker').datepicker({
        dateFormat: 'yy-mm-dd',
        setDate: new Date(),
          maxDate: new Date(),

    });


      });



      function validateForm(tbodyId,errorClass) {


        // Get the <tbody> element by its id
        let tbody = document.getElementById(tbodyId);

        // Get all checkboxes inside the <tbody>
        let checkboxes = tbody.querySelectorAll('input[type="checkbox"]');
        let required = document.querySelector(`#${errorClass}`);

        // Check if any checkbox is checked
        let isChecked = false;
        checkboxes.forEach(function (checkbox) {
          if (checkbox.checked) {
            isChecked = true;
          }
        });


            var isForm2Checked = $('#id_form-2-routine').is(':checked') || $('#id_form-2-type').is(':checked') || $('#id_form-2-special').is(':checked');

        // Check if any of the 'form-0-*' checkboxes are checked
        var isForm0Checked = $('#id_form-0-routine').is(':checked') || $('#id_form-0-type').is(':checked') || $('#id_form-0-special').is(':checked');

        // If any 'form-2-*' checkbox is checked, ensure at least one 'form-0-*' checkbox is also checked
        if(isForm2Checked && !isForm0Checked) {
            alert('If you select any option in Performance Determination Test, you must also select at least one option in the Electric Resistance Test.');
              isChecked = false;
              $('#report-required').text("At least Select one from ELectric Resistance Test");
              $('#edit-required').text('At least Select one from ELectric Resistance Test');
        }
        else{
               $('#report-required').text("At least select one from these test");
               $('#edit-required').text("At least select one from these test")
        }




        // If no checkbox is checked, alert the user and do not proceed
        if (!isChecked) {
          required.classList.remove("d-none");

          var button = document.getElementById("performed_tests");
          button.click();
          return false;


        }

        // If validation passes, close the modal programmatically
        $("#edit-modal").modal("hide");
        return true;
      }

      const initialErrorMessage = function(){
         $('#report-required').addClass('d-none');
          $('#edit-required').addClass('d-none');
      }
      
      $('#update-modal').click(function(){
         initialErrorMessage()
      })
      $('#create-record').click(function(){
         initialErrorMessage()
      })
    </script>

    {% block scripts %} {% endblock %}
  </body>
</html>
